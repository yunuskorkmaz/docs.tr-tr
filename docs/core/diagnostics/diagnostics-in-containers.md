---
title: Kapsayıcılarda tanılamayı toplayın
description: Bu makalede, .NET Core tanılama araçları 'nın Docker kapsayıcılarında nasıl kullanılabileceğini öğreneceksiniz.
ms.date: 09/01/2020
ms.openlocfilehash: e57f3696433bbf6f35b2e3e5d1e72ae8b1e3eeb3
ms.sourcegitcommit: b4a46f6d7ebf44c0035627d00924164bcae2db30
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 09/29/2020
ms.locfileid: "91451093"
---
# <a name="collect-diagnostics-in-containers"></a><span data-ttu-id="8e5fc-103">Kapsayıcılarda tanılamayı toplayın</span><span class="sxs-lookup"><span data-stu-id="8e5fc-103">Collect diagnostics in containers</span></span>

<span data-ttu-id="8e5fc-104">Diğer senaryolarda .NET Core sorunlarını tanılamak için yararlı olan aynı tanılama araçları, Docker kapsayıcılarında de çalışır.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-104">The same diagnostics tools that are useful for diagnosing .NET Core issues in other scenarios also work in Docker containers.</span></span> <span data-ttu-id="8e5fc-105">Ancak bazı araçların bir kapsayıcıda çalışması için özel adımlar gerekir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-105">However, some of the tools require special steps to work in a container.</span></span> <span data-ttu-id="8e5fc-106">Bu makalede, performans izlemelerinin toplanması ve dökümleri toplama araçlarının Docker kapsayıcılarında nasıl kullanılabileceği ele alınmaktadır.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-106">This article covers how tools for gathering performance traces and collecting dumps can be used in Docker containers.</span></span>

## <a name="using-net-core-cli-tools-in-a-container"></a><span data-ttu-id="8e5fc-107">Kapsayıcıda .NET Core CLI araçları kullanma</span><span class="sxs-lookup"><span data-stu-id="8e5fc-107">Using .NET Core CLI tools in a container</span></span>

<span data-ttu-id="8e5fc-108">**Bu araçlar için geçerlidir: ✔️** .net Core 3,0 SDK ve sonraki sürümleri</span><span class="sxs-lookup"><span data-stu-id="8e5fc-108">**These tools apply to: ✔️** .NET Core 3.0 SDK and later versions</span></span>

<span data-ttu-id="8e5fc-109">.NET Core küresel CLI tanılama araçları ( [`dotnet-counters`](dotnet-counters.md) ,, [`dotnet-dump`](dotnet-dump.md) [`dotnet-gcdump`](dotnet-gcdump.md) ve), [`dotnet-trace`](dotnet-trace.md) çok çeşitli ortamlarda çalışacak şekilde tasarlanmıştır ve tüm doğrudan Docker kapsayıcılarında çalışır.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-109">The .NET Core global CLI diagnostic tools ([`dotnet-counters`](dotnet-counters.md), [`dotnet-dump`](dotnet-dump.md), [`dotnet-gcdump`](dotnet-gcdump.md), and [`dotnet-trace`](dotnet-trace.md)) are designed to work in a wide variety of environments and should all work directly in Docker containers.</span></span> <span data-ttu-id="8e5fc-110">Bu nedenle, bu araçlar, kapsayıcılardaki .NET Core 3,0 veya üstünü (ya da 3,1 veya üzeri) hedefleyen .NET Core senaryoları için tanılama bilgilerini toplamanın tercih edilen yöntemidir `dotnet-gcdump` .</span><span class="sxs-lookup"><span data-stu-id="8e5fc-110">Because of this, these tools are the preferred method of collecting diagnostic information for .NET Core scenarios targeting .NET Core 3.0 or above (or 3.1 or above in the case of `dotnet-gcdump`) in containers.</span></span>

<span data-ttu-id="8e5fc-111">Bir kapsayıcıda bu araçların kullanıldığı tek karmaşıktonlu etken, .NET Core SDK birlikte yüklendiklerinden ve .NET Core SDK mevcut olmadan birçok Docker kapsayıcısı çalıştırdıklarından.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-111">The only complicating factor of using these tools in a container is that they are installed with the .NET Core SDK and many Docker containers run without the .NET Core SDK present.</span></span> <span data-ttu-id="8e5fc-112">Bu soruna yönelik bir kolay çözüm, araçları ilk Docker görüntüsüne yüklemektir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-112">One easy solution to this problem is to install the tools in the initial Docker image.</span></span> <span data-ttu-id="8e5fc-113">Araçların çalışması için, yalnızca yüklenmek üzere .NET Core SDK gerekmez.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-113">The tools don't need the .NET Core SDK to run, only to be installed.</span></span> <span data-ttu-id="8e5fc-114">Bu nedenle, araçları bir yapı aşamasına yükleyen (.NET Core SDK bulunan) ve ardından ikili dosyaları son görüntüye kopyalayan [çok aşamalı bir yapıda](https://docs.docker.com/develop/develop-images/multistage-build/) Dockerfile oluşturmak mümkündür.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-114">Therefore, it's possible to create a Dockerfile with a [multi-stage build](https://docs.docker.com/develop/develop-images/multistage-build/) that installs the tools in a build stage (where the .NET Core SDK is present) and then copies the binaries into the final image.</span></span> <span data-ttu-id="8e5fc-115">Bu yaklaşımın tek yanından yalnızca Docker görüntü boyutu artar.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-115">The only downside to this approach is increased Docker image size.</span></span>

```dockerfile
# In build stage
# Install desired .NET CLI diagnostics tools
RUN dotnet tool install --tool-path /tools dotnet-trace
RUN dotnet tool install --tool-path /tools dotnet-counters
RUN dotnet tool install --tool-path /tools dotnet-dump

...

# In final stage
# Copy diagnostics tools
WORKDIR /tools
COPY --from=build /tools .
```

<span data-ttu-id="8e5fc-116">Alternatif olarak, CLı araçlarını yüklemek için gerektiğinde .NET Core SDK bir kapsayıcıya yüklenebilir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-116">Alternatively, the .NET Core SDK can be installed in a container when needed in order to install the CLI tools.</span></span> <span data-ttu-id="8e5fc-117">.NET Core SDK yüklemesinin .NET Core çalışma zamanını yeniden yüklemenin yan etkisi olacağını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-117">Be aware that installing the .NET Core SDK will have the side-effect of reinstalling the .NET Core runtime.</span></span> <span data-ttu-id="8e5fc-118">Bu nedenle, kapsayıcıda bulunan çalışma zamanına uyan SDK sürümünü yüklediğinizden emin olun.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-118">So be sure to install the version of the SDK that matches the runtime present in the container.</span></span>

### <a name="using-net-core-global-cli-tools-in-a-sidecar-container"></a><span data-ttu-id="8e5fc-119">.NET Core küresel CLı araçlarını bir sepet kapsayıcısında kullanma</span><span class="sxs-lookup"><span data-stu-id="8e5fc-119">Using .NET Core global CLI tools in a sidecar container</span></span>

<span data-ttu-id="8e5fc-120">Farklı bir kapsayıcıdaki işlemlerin tanılanması için .NET Core küresel CLı tanılama araçlarını kullanmak istiyorsanız, aşağıdaki ek gereksinimleri göz önünde bulundurun:</span><span class="sxs-lookup"><span data-stu-id="8e5fc-120">If you would like to use .NET Core global CLI diagnostic tools to diagnose processes in a different container, bear the following additional requirements in mind:</span></span>

1. <span data-ttu-id="8e5fc-121">Kapsayıcılar [bir işlem ad alanını paylaşmalıdır](https://docs.docker.com/engine/reference/run/#pid-settings---pid) (böylece sepet kapsayıcısındaki araçların hedef kapsayıcıdaki işlemlere erişebilmesi için).</span><span class="sxs-lookup"><span data-stu-id="8e5fc-121">The containers must [share a process namespace](https://docs.docker.com/engine/reference/run/#pid-settings---pid) (so that tools in the sidecar container can access processes in the target container).</span></span>
2. <span data-ttu-id="8e5fc-122">.NET Core küresel CLı tanılama araçları, .NET Core çalışma zamanının/tmp dizinine yazdığı dosyalara erişmesi gerekir, bu nedenle/tmp dizini bir birim bağlama aracılığıyla hedef ve sepet kapsayıcısı arasında paylaşılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-122">The .NET Core global CLI diagnostic tools need access to files the .NET Core runtime writes to the /tmp directory, so the /tmp directory must be shared between the target and sidecar container via a volume mount.</span></span> <span data-ttu-id="8e5fc-123">Bu, örneğin, kapsayıcıların ortak bir [birimi](https://docs.docker.com/storage/volumes/#create-and-manage-volumes) veya Kubernetes [emptydir](https://kubernetes.io/docs/concepts/storage/volumes/#emptydir) birimini paylaşmasını sağlayarak yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-123">This could be done, for example, by having the containers share a common [volume](https://docs.docker.com/storage/volumes/#create-and-manage-volumes) or a Kubernetes [emptyDir](https://kubernetes.io/docs/concepts/storage/volumes/#emptydir) volume.</span></span> <span data-ttu-id="8e5fc-124">/Tmp dizinini paylaşmadan bir sepet kapsayıcısından tanılama araçlarını kullanmayı denerseniz, "uyumlu .NET çalışma zamanı çalışmıyor" işlemiyle ilgili bir hata alırsınız.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-124">If you attempt to use the diagnostic tools from a sidecar container without sharing the /tmp directory, you will get an error about the process "not running compatible .NET runtime."</span></span>

## <a name="using-perfcollect-in-a-container"></a><span data-ttu-id="8e5fc-125">`PerfCollect`Kapsayıcıda kullanma</span><span class="sxs-lookup"><span data-stu-id="8e5fc-125">Using `PerfCollect` in a container</span></span>

<span data-ttu-id="8e5fc-126">**Bu araç şu şekilde geçerlidir: ✔️** .net Core 2,1 ve sonraki sürümleri</span><span class="sxs-lookup"><span data-stu-id="8e5fc-126">**This tool applies to: ✔️** .NET Core 2.1 and later versions</span></span>

<span data-ttu-id="8e5fc-127">[`PerfCollect`](https://github.com/dotnet/coreclr/blob/master/Documentation/project-docs/linux-performance-tracing.md)Betik, performans izlemelerini toplamak için faydalıdır ve .NET Core 3,0 ' den önce izlemeleri toplamak için önerilen araçtır.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-127">The [`PerfCollect`](https://github.com/dotnet/coreclr/blob/master/Documentation/project-docs/linux-performance-tracing.md) script is useful for collecting performance traces and is the recommended tool for collecting traces prior to .NET Core 3.0.</span></span> <span data-ttu-id="8e5fc-128">`PerfCollect`Bir kapsayıcıda kullanıyorsanız, aşağıdaki gereksinimleri göz önünde bulundurun:</span><span class="sxs-lookup"><span data-stu-id="8e5fc-128">If using `PerfCollect` in a container, keep the following requirements in mind:</span></span>

1. <span data-ttu-id="8e5fc-129">`PerfCollect`[ `SYS_ADMIN` özelliği](https://man7.org/linux/man-pages/man7/capabilities.7.html) gerektirir (aracı çalıştırmak için `perf` ), kapsayıcının [Bu özellik ile başlatıldığından](https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities)emin olun.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-129">`PerfCollect` requires the [`SYS_ADMIN` capability](https://man7.org/linux/man-pages/man7/capabilities.7.html) (in order to run the `perf` tool), so be sure the container is [started with that capability](https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities).</span></span>
2. <span data-ttu-id="8e5fc-130">`PerfCollect` profil oluşturmanın başladığı uygulamadan önce bazı ortam değişkenlerinin ayarlanmasını gerektirir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-130">`PerfCollect` requires some environment variables be set prior to the app it is profiling starting.</span></span> <span data-ttu-id="8e5fc-131">Bunlar bir [Dockerfile](https://docs.docker.com/engine/reference/builder/#env) içinde ya da [kapsayıcı başlatılırken](https://docs.docker.com/engine/reference/run/#env-environment-variables)ayarlanabilir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-131">These can be set either in a [Dockerfile](https://docs.docker.com/engine/reference/builder/#env) or when [starting the container](https://docs.docker.com/engine/reference/run/#env-environment-variables).</span></span> <span data-ttu-id="8e5fc-132">Bu değişkenlerin normal üretim ortamlarında ayarlanmaması gerektiğinden, profili oluşturulacak bir kapsayıcıyı başlatırken yalnızca eklemeniz yaygındır.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-132">Because these variables shouldn't be set in normal production environments, it's common to just add them when starting a container that will be profiled.</span></span> <span data-ttu-id="8e5fc-133">PerfCollect 'in gerektirdiği iki değişken şunlardır:</span><span class="sxs-lookup"><span data-stu-id="8e5fc-133">The two variables which PerfCollect requires are:</span></span>
    1. <span data-ttu-id="8e5fc-134">COMPlus_PerfMapEnabled = 1</span><span class="sxs-lookup"><span data-stu-id="8e5fc-134">COMPlus_PerfMapEnabled=1</span></span>
    1. <span data-ttu-id="8e5fc-135">COMPlus_EnableEventLog = 1</span><span class="sxs-lookup"><span data-stu-id="8e5fc-135">COMPlus_EnableEventLog=1</span></span>

### <a name="using-perfcollect-in-a-sidecar-container"></a><span data-ttu-id="8e5fc-136">`PerfCollect`Bir sepet kapsayıcısında kullanma</span><span class="sxs-lookup"><span data-stu-id="8e5fc-136">Using `PerfCollect` in a sidecar container</span></span>

<span data-ttu-id="8e5fc-137">`PerfCollect`Farklı bir kapsayıcıda .NET Core işleminin profilini oluşturmak için tek bir kapsayıcıda çalıştırmak istiyorsanız, deneyim Şu farklar dışında neredeyse aynıdır:</span><span class="sxs-lookup"><span data-stu-id="8e5fc-137">If you would like to run `PerfCollect` in one container to profile a .NET Core process in a different container, the experience is almost the same except for these differences:</span></span>

1. <span data-ttu-id="8e5fc-138">Daha önce bahsedilen ortam değişkenleri (COMPlus_PerfMapEnabled ve COMPlus_EnableEventLog) hedef kapsayıcı için ayarlanmalıdır (çalışmıyor `PerfCollect` ).</span><span class="sxs-lookup"><span data-stu-id="8e5fc-138">The environment variables mentioned previously (COMPlus_PerfMapEnabled and COMPlus_EnableEventLog) must be set for the target container (not the one running `PerfCollect`).</span></span>
2. <span data-ttu-id="8e5fc-139">Çalışan kapsayıcının `PerfCollect` `SYS_ADMIN` özelliği olmalıdır (hedef kapsayıcı değil).</span><span class="sxs-lookup"><span data-stu-id="8e5fc-139">The container running `PerfCollect` must have the `SYS_ADMIN` capability (not the target container).</span></span>
3. <span data-ttu-id="8e5fc-140">İki kapsayıcı [bir işlem ad alanını paylaşmalıdır](https://docs.docker.com/engine/reference/run/#pid-settings---pid).</span><span class="sxs-lookup"><span data-stu-id="8e5fc-140">The two containers must [share a process namespace](https://docs.docker.com/engine/reference/run/#pid-settings---pid).</span></span>

## <a name="using-createdump-in-a-container"></a><span data-ttu-id="8e5fc-141">`createdump`Kapsayıcıda kullanma</span><span class="sxs-lookup"><span data-stu-id="8e5fc-141">Using `createdump` in a container</span></span>

<span data-ttu-id="8e5fc-142">**Bu araç şu şekilde geçerlidir: ✔️** .net Core 2,1 ve sonraki sürümleri</span><span class="sxs-lookup"><span data-stu-id="8e5fc-142">**This tool applies to: ✔️** .NET Core 2.1 and later versions</span></span>

<span data-ttu-id="8e5fc-143">Bir alternatifi `dotnet-dump` , [`createdump`](https://github.com/dotnet/runtime/blob/master/docs/design/coreclr/botr/xplat-minidump-generation.md) hem yerel hem de yönetilen bilgileri içeren Linux üzerinde temel dökümler oluşturmak için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-143">An alternative to `dotnet-dump`, [`createdump`](https://github.com/dotnet/runtime/blob/master/docs/design/coreclr/botr/xplat-minidump-generation.md) can be used for creating core dumps on Linux containing both native and managed information.</span></span> <span data-ttu-id="8e5fc-144">`createdump`Araç .NET Core çalışma zamanı ile yüklenir ve libcoreclr.so ' nin yanında (genellikle "/usr/share/DotNet/Shared/Microsoft.NETCore.app/[Version]" içinde) bulunabilir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-144">The `createdump` tool is installed with the .NET Core runtime and can be found next to libcoreclr.so (typically in "/usr/share/dotnet/shared/Microsoft.NETCore.App/[version]").</span></span> <span data-ttu-id="8e5fc-145">Araç, kapsayıcı olmayan Linux ortamlarında aynı şekilde, aracın [ `SYS_PTRACE` özelliği](https://man7.org/linux/man-pages/man7/capabilities.7.html)gerektirdiği tek bir özel durum ile aynı şekilde çalışmaya devam eder, bu nedenle Docker kapsayıcısının [Bu yetenek ile başlatılması](https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities)gerekir.</span><span class="sxs-lookup"><span data-stu-id="8e5fc-145">The tool works the same in a container as it does in non-containerized Linux environments with the single exception that the tool requires the [`SYS_PTRACE` capability](https://man7.org/linux/man-pages/man7/capabilities.7.html), so the Docker container must be [started with that capability](https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities).</span></span>

### <a name="using-createdump-in-a-sidecar-container"></a><span data-ttu-id="8e5fc-146">`createdump`Bir sepet kapsayıcısında kullanma</span><span class="sxs-lookup"><span data-stu-id="8e5fc-146">Using `createdump` in a sidecar container</span></span>

<span data-ttu-id="8e5fc-147">`createdump`Farklı bir kapsayıcıda bir işlemden döküm oluşturmak için kullanmak istiyorsanız, deneyim Şu farklar dışında neredeyse aynıdır:</span><span class="sxs-lookup"><span data-stu-id="8e5fc-147">If you would like to use `createdump` to create a dump from a process in a different container, the experience is almost the same except for these differences:</span></span>

1. <span data-ttu-id="8e5fc-148">Çalışan kapsayıcının `createdump` `SYS_PTRACE` özelliği olmalıdır (hedef kapsayıcı değil).</span><span class="sxs-lookup"><span data-stu-id="8e5fc-148">The container running `createdump` must have the `SYS_PTRACE` capability (not the target container).</span></span>
2. <span data-ttu-id="8e5fc-149">İki kapsayıcı [bir işlem ad alanını paylaşmalıdır](https://docs.docker.com/engine/reference/run/#pid-settings---pid).</span><span class="sxs-lookup"><span data-stu-id="8e5fc-149">The two containers must [share a process namespace](https://docs.docker.com/engine/reference/run/#pid-settings---pid).</span></span>
