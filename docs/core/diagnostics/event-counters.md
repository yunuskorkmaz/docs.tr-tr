---
title: .NET Core 'da EventCounters
description: Bu makalede, olaylarınızın ne olduğunu, nasıl uygulanacağını ve bunları nasıl kullanacağınızı öğreneceksiniz.
ms.date: 08/07/2020
ms.openlocfilehash: 68868ff8b4e1393fc3b23af2bc8eef239ac56975
ms.sourcegitcommit: 1e6439ec4d5889fc08cf3bfb4dac2b91931eb827
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 08/08/2020
ms.locfileid: "88025022"
---
# <a name="eventcounters-in-net-core"></a><span data-ttu-id="fe06b-103">.NET Core 'da EventCounters</span><span class="sxs-lookup"><span data-stu-id="fe06b-103">EventCounters in .NET Core</span></span>

<span data-ttu-id="fe06b-104">**Bu makale şu şekilde geçerlidir: ✔️** .net Core 3,0 SDK ve sonraki sürümleri</span><span class="sxs-lookup"><span data-stu-id="fe06b-104">**This article applies to: ✔️** .NET Core 3.0 SDK and later versions</span></span>

<span data-ttu-id="fe06b-105">EventCounters, hafif, platformlar arası ve neredeyse gerçek zamanlı performans ölçümü koleksiyonu için kullanılan .NET Core API 'larıdır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-105">EventCounters are .NET Core APIs used for lightweight, cross-platform, and near real-time performance metric collection.</span></span> <span data-ttu-id="fe06b-106">EventCounters, Windows üzerindeki .NET Framework "performans sayaçları" için platformlar arası bir alternatif olarak eklenmiştir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-106">EventCounters were added as a cross-platform alternative to the "performance counters" of the .NET Framework on Windows.</span></span> <span data-ttu-id="fe06b-107">Bu makalede, olaylarınızın ne olduğunu, nasıl uygulanacağını ve bunları nasıl kullanacağınızı öğreneceksiniz.</span><span class="sxs-lookup"><span data-stu-id="fe06b-107">In this article you'll learn what EventCounters are, how to implement them, and how to consume them.</span></span>

<span data-ttu-id="fe06b-108">.NET Core çalışma zamanı ve birkaç .NET kitaplığı, .NET Core 3,0 ' den başlayarak EventCounters kullanarak temel tanılama bilgilerini yayımlar.</span><span class="sxs-lookup"><span data-stu-id="fe06b-108">The .NET Core runtime and a few .NET libraries publish basic diagnostics information using EventCounters starting in .NET Core 3.0.</span></span> <span data-ttu-id="fe06b-109">.NET çalışma zamanı tarafından sunulan EventCounters dışında, kendi Eventsayaçlarınızı uygulamayı seçebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="fe06b-109">Apart from the EventCounters that are provided by the .NET runtime, you may choose to implement your own EventCounters.</span></span> <span data-ttu-id="fe06b-110">EventCounters, çeşitli ölçümleri izlemek için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-110">EventCounters can be used to track various metrics.</span></span>

<span data-ttu-id="fe06b-111">EventCounters, bir parçası olarak bulunur <xref:System.Diagnostics.Tracing.EventSource> ve otomatik olarak dinleyici araçlarına düzenli olarak gönderilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-111">EventCounters live as a part of an <xref:System.Diagnostics.Tracing.EventSource>, and are automatically pushed to listener tools on a regular basis.</span></span> <span data-ttu-id="fe06b-112">İçindeki tüm diğer olaylar gibi <xref:System.Diagnostics.Tracing.EventSource> , bunlar hem işlem içi hem de işlem dışı <xref:System.Diagnostics.Tracing.EventListener> ve eventpipe ile tüketilebilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-112">Like all other events on an <xref:System.Diagnostics.Tracing.EventSource>, they can be consumed both in-proc and out-of-proc via <xref:System.Diagnostics.Tracing.EventListener> and EventPipe.</span></span> <span data-ttu-id="fe06b-113">Bu makale, EventCounters 'in platformlar arası özelliklerine odaklanmaktadır ve özellikle PerfView ve ETW (Windows için olay Izleme) özelliğini dışlar, ancak her ikisi de EventCounters ile kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-113">This article focuses on the cross-platform capabilities of EventCounters, and intentionally excludes PerfView and ETW (Event Tracing for Windows) - although both can be used with EventCounters.</span></span>

![-Proc ve proc dışı diyagram görüntüsü EventCounters](media/event-counters.svg)

[!INCLUDE [available-counters](includes/available-counters.md)]

## <a name="eventcounter-api-overview"></a><span data-ttu-id="fe06b-115">EventCounter API 'sine genel bakış</span><span class="sxs-lookup"><span data-stu-id="fe06b-115">EventCounter API overview</span></span>

<span data-ttu-id="fe06b-116">Sayaçların iki birincil kategorisi vardır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-116">There are two primary categories of counters.</span></span> <span data-ttu-id="fe06b-117">Bazı sayaçlar, toplam özel durum sayısı, toplam GB sayısı ve toplam istek sayısı gibi "ücret" değerleri için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-117">Some counters are for "rate" values, such as total number of exceptions, total number of GCs, and total number of requests.</span></span> <span data-ttu-id="fe06b-118">Diğer sayaçlar, yığın kullanımı, CPU kullanımı ve çalışma kümesi boyutu gibi "Snapshot" değerleridir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-118">Other counters are "snapshot" values, such as heap usage, CPU usage, and working set size.</span></span> <span data-ttu-id="fe06b-119">Bu sayaçların her bir kategorisi içinde, değerlerini alma yoluyla değişen iki tür sayaç vardır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-119">Within each of these categories of counters, there are two types of counters that vary by how they get their value.</span></span> <span data-ttu-id="fe06b-120">Yoklama sayaçları, bir geri çağırma yoluyla değerlerini alır ve yoklamasız sayaçların değerleri doğrudan sayaç örneğinde ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-120">Polling counters retrieve their value via a callback, and non-polling counters have their values directly set on the counter instance.</span></span>

<span data-ttu-id="fe06b-121">Sayaçlar aşağıdaki uygulamalarla temsil edilir:</span><span class="sxs-lookup"><span data-stu-id="fe06b-121">The counters are represented by the following implementations:</span></span>

* <xref:System.Diagnostics.Tracing.EventCounter>
* <xref:System.Diagnostics.Tracing.IncrementingEventCounter>
* <xref:System.Diagnostics.Tracing.IncrementingPollingCounter>
* <xref:System.Diagnostics.Tracing.PollingCounter>

<span data-ttu-id="fe06b-122">Bir olay dinleyicisi, ölçüm aralıklarının ne kadar süreyle olduğunu belirtir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-122">An event listener specifies how long measurement intervals are.</span></span> <span data-ttu-id="fe06b-123">Her bir aralığın sonunda, her sayaç için dinleyiciye bir değer iletilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-123">At the end of each interval a value is transmitted to the listener for each counter.</span></span> <span data-ttu-id="fe06b-124">Bir sayacın uygulamaları, her aralığa değer üretmek için hangi API 'Lerin ve hesaplamaların kullanılacağını tespit edilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-124">The implementations of a counter determine what APIs and calculations are used to produce the value each interval.</span></span>

1. <span data-ttu-id="fe06b-125"><xref:System.Diagnostics.Tracing.EventCounter>Bir değer kümesini kaydeder.</span><span class="sxs-lookup"><span data-stu-id="fe06b-125">The <xref:System.Diagnostics.Tracing.EventCounter> records a set of values.</span></span> <span data-ttu-id="fe06b-126"><xref:System.Diagnostics.Tracing.EventCounter.WriteMetric%2A?displayProperty=nameWithType>Yöntemi, kümesine yeni bir değer ekler.</span><span class="sxs-lookup"><span data-stu-id="fe06b-126">The <xref:System.Diagnostics.Tracing.EventCounter.WriteMetric%2A?displayProperty=nameWithType> method adds a new value to the set.</span></span> <span data-ttu-id="fe06b-127">Her aralığa göre, en az, en fazla ve ortalama gibi, küme için istatistiksel bir Özet hesaplanır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-127">With each interval, a statistical summary for the set is computed, such as the min, max, and mean.</span></span> <span data-ttu-id="fe06b-128">[DotNet-Counters](dotnet-counters.md) aracı her zaman ortalama değeri görüntüler.</span><span class="sxs-lookup"><span data-stu-id="fe06b-128">The [dotnet-counters](dotnet-counters.md) tool will always display the mean value.</span></span> <span data-ttu-id="fe06b-129">, <xref:System.Diagnostics.Tracing.EventCounter> Ayrı bir işlem kümesini tanımlamaya yarar.</span><span class="sxs-lookup"><span data-stu-id="fe06b-129">The <xref:System.Diagnostics.Tracing.EventCounter> is useful to describe a discrete set of operations.</span></span> <span data-ttu-id="fe06b-130">Yaygın kullanım, son GÇ işlemlerinin bayt cinsinden ortalama boyutunu veya bir dizi mali işlemin ortalama parasal değerini izlemeyi içerebilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-130">Common usage may include monitoring the average size in bytes of recent IO operations, or the average monetary value of a set of financial transactions.</span></span>

1. <span data-ttu-id="fe06b-131"><xref:System.Diagnostics.Tracing.IncrementingEventCounter>Her zaman aralığı için çalışan bir toplam kaydeder.</span><span class="sxs-lookup"><span data-stu-id="fe06b-131">The <xref:System.Diagnostics.Tracing.IncrementingEventCounter> records a running total for each time interval.</span></span> <span data-ttu-id="fe06b-132"><xref:System.Diagnostics.Tracing.IncrementingEventCounter.Increment%2A?displayProperty=nameWithType>Yöntemi toplam 'a ekler.</span><span class="sxs-lookup"><span data-stu-id="fe06b-132">The <xref:System.Diagnostics.Tracing.IncrementingEventCounter.Increment%2A?displayProperty=nameWithType> method adds to the total.</span></span> <span data-ttu-id="fe06b-133">Örneğin, `Increment()` ve değerlerini içeren bir Aralık sırasında üç kez çağrılırsa, `1` `2` `5` çalışma toplamı `8` Bu Aralık için sayaç değeri olarak raporlanır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-133">For example, if `Increment()` is called three times during one interval with values `1`, `2`, and `5`, then the running total of `8` will be reported as the counter value for this interval.</span></span> <span data-ttu-id="fe06b-134">[DotNet-Counters](dotnet-counters.md) Aracı, kaydedilen toplam/saat olarak oranı görüntüler.</span><span class="sxs-lookup"><span data-stu-id="fe06b-134">The [dotnet-counters](dotnet-counters.md) tool will display the rate as the recorded total / time.</span></span> <span data-ttu-id="fe06b-135">, <xref:System.Diagnostics.Tracing.IncrementingEventCounter> Saniye başına işlenen istek sayısı gibi bir eylemin ne sıklıkla oluştuğunu ölçmek için yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-135">The <xref:System.Diagnostics.Tracing.IncrementingEventCounter> is useful to measure how frequently an action is occurring, such as the number of requests processed per second.</span></span>

1. <span data-ttu-id="fe06b-136">, <xref:System.Diagnostics.Tracing.PollingCounter> Bildirilen değeri belirlemekte bir geri çağırma kullanır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-136">The <xref:System.Diagnostics.Tracing.PollingCounter> uses a callback to determine the value that is reported.</span></span> <span data-ttu-id="fe06b-137">Her zaman aralığı ile, Kullanıcı tarafından girilen geri çağırma işlevi çağrılır ve dönüş değeri sayaç değeri olarak kullanılır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-137">With each time interval, the user provided callback function is invoked and the return value is used as the counter value.</span></span> <span data-ttu-id="fe06b-138">Bir <xref:System.Diagnostics.Tracing.PollingCounter> dış kaynaktan bir ölçümü sorgulamak için, örneğin, bir diskteki geçerli boş baytları almak için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-138">A <xref:System.Diagnostics.Tracing.PollingCounter> can be used to query a metric from an external source, for example getting the current free bytes on a disk.</span></span> <span data-ttu-id="fe06b-139">Ayrıca, bir uygulama tarafından talep üzerine hesaplanmayan özel istatistikleri raporlamak için de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-139">It can also be used to report custom statistics that can be computed on demand by an application.</span></span> <span data-ttu-id="fe06b-140">Örnekler arasında, son istek gecikmelerinin 95. Yüzdeliğini veya bir Önbelleğin geçerli isabet veya isabetsizlik oranını raporlama sayılabilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-140">Examples include reporting the 95th percentile of recent request latencies, or the current hit or miss ratio of a cache.</span></span>

1. <span data-ttu-id="fe06b-141">, <xref:System.Diagnostics.Tracing.IncrementingPollingCounter> Bildirilen artış değerini tespit etmek için bir geri çağırma kullanır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-141">The <xref:System.Diagnostics.Tracing.IncrementingPollingCounter> uses a callback to determine the reported increment value.</span></span> <span data-ttu-id="fe06b-142">Her zaman aralığı ile geri çağırma çağrılır ve sonra geçerli çağrı ve son çağırma değeri bildirilen değerdir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-142">With each time interval, the callback is invoked, and then the difference between the current invocation, and the last invocation is the reported value.</span></span> <span data-ttu-id="fe06b-143">[DotNet-Counters](dotnet-counters.md) aracı her zaman bir hız, bildirilen değer/saat olarak farkı görüntüler.</span><span class="sxs-lookup"><span data-stu-id="fe06b-143">The [dotnet-counters](dotnet-counters.md) tool will always display the difference as a rate, the reported value / time.</span></span> <span data-ttu-id="fe06b-144">Bu sayaç, her bir yerde API çağrısı yapmak uygun olmadığında yararlıdır, ancak toplam oluşum sayısını sorgulamak mümkündür.</span><span class="sxs-lookup"><span data-stu-id="fe06b-144">This counter is useful when it isn't feasible to call an API on each occurrence, but it's possible to query the total number of occurrences.</span></span> <span data-ttu-id="fe06b-145">Örneğin, bir bayt her yazıldığında bir bildirime gerek kalmadan, dosyaya yazılan bayt sayısını rapor edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="fe06b-145">For example, you could report the number of bytes written to a file per second, even without a notification each time a byte is written.</span></span>

## <a name="implement-an-eventsource"></a><span data-ttu-id="fe06b-146">EventSource uygulama</span><span class="sxs-lookup"><span data-stu-id="fe06b-146">Implement an EventSource</span></span>

<span data-ttu-id="fe06b-147">Aşağıdaki kod, <xref:System.Diagnostics.Tracing.EventSource> adlandırılmış sağlayıcı olarak kullanıma sunulan bir örnek uygular `"Sample.EventCounter.Minimal"` .</span><span class="sxs-lookup"><span data-stu-id="fe06b-147">The following code implements a sample <xref:System.Diagnostics.Tracing.EventSource> exposed as the named `"Sample.EventCounter.Minimal"` provider.</span></span> <span data-ttu-id="fe06b-148">Bu kaynak, bir <xref:System.Diagnostics.Tracing.EventCounter> temsil eden istek işleme süresini içerir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-148">This source contains an <xref:System.Diagnostics.Tracing.EventCounter> representing request processing time.</span></span> <span data-ttu-id="fe06b-149">Bu tür bir sayaç, her ikisi de [DotNet-Counter](dotnet-counters.md)gibi dinleyici araçları tarafından kullanılan bir ada (yani, KAYNAKTAKI benzersiz kimliği) ve görünen ada sahiptir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-149">Such a counter has a name (that is, its unique ID in the source) and a display name, both used by listener tools such as [dotnet-counter](dotnet-counters.md).</span></span>

:::code language="csharp" source="snippets/EventCounters/MinimalEventCounterSource.cs":::

<span data-ttu-id="fe06b-150">`dotnet-counters ps`İzlenebilecek .net işlemlerinin bir listesini göstermek için kullanırsınız:</span><span class="sxs-lookup"><span data-stu-id="fe06b-150">You use `dotnet-counters ps` to display a list of .NET processes that can be monitored:</span></span>

```console
dotnet-counters ps
   1398652 dotnet     C:\Program Files\dotnet\dotnet.exe
   1399072 dotnet     C:\Program Files\dotnet\dotnet.exe
   1399112 dotnet     C:\Program Files\dotnet\dotnet.exe
   1401880 dotnet     C:\Program Files\dotnet\dotnet.exe
   1400180 sample-counters C:\sample-counters\bin\Debug\netcoreapp3.1\sample-counters.exe
```

<span data-ttu-id="fe06b-151"><xref:System.Diagnostics.Tracing.EventSource> `counter_list` Sayaçlarınızı izlemeye başlamak için adı anahtara geçirin:</span><span class="sxs-lookup"><span data-stu-id="fe06b-151">Pass the <xref:System.Diagnostics.Tracing.EventSource> name to the `counter_list` switch to start monitoring your counter:</span></span>

```console
dotnet-counters monitor --process-id 1400180 Sample.EventCounter.Minimal
```

<span data-ttu-id="fe06b-152">Aşağıdaki örnek izleme çıkışını gösterir:</span><span class="sxs-lookup"><span data-stu-id="fe06b-152">The following example shows monitor output:</span></span>

```console
Press p to pause, r to resume, q to quit.
    Status: Running

[Samples-EventCounterDemos-Minimal]
    Request Processing Time (ms)                            0.445
```

<span data-ttu-id="fe06b-153">İzleme komutunu durdurmak için <kbd>q</kbd> tuşuna basın.</span><span class="sxs-lookup"><span data-stu-id="fe06b-153">Press <kbd>q</kbd> to stop the monitoring command.</span></span>

#### <a name="conditional-counters"></a><span data-ttu-id="fe06b-154">Koşullu sayaçlar</span><span class="sxs-lookup"><span data-stu-id="fe06b-154">Conditional counters</span></span>

<span data-ttu-id="fe06b-155">Bir uygularken <xref:System.Diagnostics.Tracing.EventSource> , <xref:System.Diagnostics.Tracing.EventSource.OnEventCommand%2A?displayProperty=nameWithType> Yöntem değeri ile çağrıldığında kapsayan sayaçlar koşullu olarak oluşturulabilir <xref:System.Diagnostics.Tracing.EventCommandEventArgs.Command> `EventCommand.Enable` .</span><span class="sxs-lookup"><span data-stu-id="fe06b-155">When implementing an <xref:System.Diagnostics.Tracing.EventSource>, the containing counters can be conditionally instantiated when the <xref:System.Diagnostics.Tracing.EventSource.OnEventCommand%2A?displayProperty=nameWithType> method is called with a <xref:System.Diagnostics.Tracing.EventCommandEventArgs.Command> value of `EventCommand.Enable`.</span></span> <span data-ttu-id="fe06b-156">Yalnızca bir sayaç örneğinin güvenli bir şekilde örneğini oluşturmak için `null` , [null birleşim atama işlecini](../../csharp/language-reference/operators/null-coalescing-operator.md)kullanın.</span><span class="sxs-lookup"><span data-stu-id="fe06b-156">To safely instantiate a counter instance only if it is `null`, use the [null-coalescing assignment operator](../../csharp/language-reference/operators/null-coalescing-operator.md).</span></span> <span data-ttu-id="fe06b-157">Ayrıca, özel yöntemler <xref:System.Diagnostics.DiagnosticSource.IsEnabled%2A> geçerli olay kaynağının etkinleştirilip etkinleştirilmediğini belirleme yöntemini değerlendirebilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-157">Additionally, custom methods can evaluate the <xref:System.Diagnostics.DiagnosticSource.IsEnabled%2A> method to determine whether or not the current event source is enabled.</span></span>

:::code language="csharp" source="snippets/EventCounters/ConditionalEventCounterSource.cs":::

> [!TIP]
> <span data-ttu-id="fe06b-158">Koşullu sayaçlar, mikro iyileştirmede koşullu olarak oluşturulan sayaçlardır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-158">Conditional counters are counters that are conditionally instantiated, a micro-optimization.</span></span> <span data-ttu-id="fe06b-159">Çalışma zamanı, bir milisaniyenin bir bölümünü kaydetmek için sayaçların normalde kullanılmayan senaryolar için bu stili benimseyen.</span><span class="sxs-lookup"><span data-stu-id="fe06b-159">The runtime adopts this pattern for scenarios where counters are normally not used, to save a fraction of a millisecond.</span></span>

### <a name="net-core-runtime-example-counters"></a><span data-ttu-id="fe06b-160">.NET Core çalışma zamanı örnek sayaçları</span><span class="sxs-lookup"><span data-stu-id="fe06b-160">.NET Core runtime example counters</span></span>

<span data-ttu-id="fe06b-161">.NET Core çalışma zamanı 'nda çok sayıda harika örnek uygulama vardır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-161">There are many great example implementations in the .NET Core runtime.</span></span> <span data-ttu-id="fe06b-162">Uygulamanın çalışma kümesi boyutunu izleyen sayaca yönelik çalışma zamanı uygulaması aşağıda verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-162">Here is the runtime implementation for the counter that tracks the working set size of the application.</span></span>

```csharp
var workingSetCounter = new PollingCounter(
    "working-set",
    this,
    () => (double)(Environment.WorkingSet / 1_000_000))
{
    DisplayName = "Working Set",
    DisplayUnits = "MB"
};
```

<span data-ttu-id="fe06b-163">, <xref:System.Diagnostics.Tracing.PollingCounter> Bir ölçüm zaman içinde yakalandığından, uygulamanın işlem (çalışma kümesi) ile eşlenen geçerli fiziksel bellek miktarını raporlar.</span><span class="sxs-lookup"><span data-stu-id="fe06b-163">The <xref:System.Diagnostics.Tracing.PollingCounter> reports the current amount of physical memory mapped to the process (working set) of the app, since it captures a metric at a moment in time.</span></span> <span data-ttu-id="fe06b-164">Bir değeri yoklamak için geri çağırma, yalnızca API çağrısı olan, belirtilen lambda ifadesidir <xref:System.Environment.WorkingSet?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="fe06b-164">The callback for polling a value is the provided lambda expression, which is just a call to the <xref:System.Environment.WorkingSet?displayProperty=fullName> API.</span></span> <span data-ttu-id="fe06b-165"><xref:System.Diagnostics.Tracing.DiagnosticCounter.DisplayName>ve, <xref:System.Diagnostics.Tracing.DiagnosticCounter.DisplayUnits> sayacın Tüketici tarafında değeri daha net bir şekilde görüntüleme konusunda yardımcı olmak üzere ayarlanabilir, isteğe bağlı özelliklerdir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-165"><xref:System.Diagnostics.Tracing.DiagnosticCounter.DisplayName> and <xref:System.Diagnostics.Tracing.DiagnosticCounter.DisplayUnits> are optional properties that can be set to help the consumer side of the counter to display the value more clearly.</span></span> <span data-ttu-id="fe06b-166">Örneğin, [DotNet sayaçları](dotnet-counters.md) , sayaç adlarının daha kolay görünen bir sürümünü göstermek için bu özellikleri kullanır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-166">For example, [dotnet-counters](dotnet-counters.md) uses these properties to display the more display-friendly version of the counter names.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fe06b-167">`DisplayName`Özellikler yerelleştirilmemiş.</span><span class="sxs-lookup"><span data-stu-id="fe06b-167">The `DisplayName` properties are not localized.</span></span>

<span data-ttu-id="fe06b-168">, Ve için, <xref:System.Diagnostics.Tracing.PollingCounter> <xref:System.Diagnostics.Tracing.IncrementingPollingCounter> başka hiçbir şeyin gerçekleştirilmesi gerekmez.</span><span class="sxs-lookup"><span data-stu-id="fe06b-168">For the <xref:System.Diagnostics.Tracing.PollingCounter>, and the <xref:System.Diagnostics.Tracing.IncrementingPollingCounter>, nothing else needs to be done.</span></span> <span data-ttu-id="fe06b-169">Bunlar her ikisi de, tüketicinin istediği bir aralıkta değerleri yoklalar.</span><span class="sxs-lookup"><span data-stu-id="fe06b-169">They both poll the values themselves at an interval requested by the consumer.</span></span>

<span data-ttu-id="fe06b-170">Kullanılarak uygulanan bir çalışma zamanı sayacı örneği aşağıda verilmiştir <xref:System.Diagnostics.Tracing.IncrementingPollingCounter> .</span><span class="sxs-lookup"><span data-stu-id="fe06b-170">Here is an example of a runtime counter implemented using <xref:System.Diagnostics.Tracing.IncrementingPollingCounter>.</span></span>

```csharp
var monitorContentionCounter = new IncrementingPollingCounter(
    "monitor-lock-contention-count",
    this,
    () => Monitor.LockContentionCount
)
{
    DisplayName = "Monitor Lock Contention Count",
    DisplayRateTimeScale = TimeSpan.FromSeconds(1)
};
```

<span data-ttu-id="fe06b-171">, <xref:System.Diagnostics.Tracing.IncrementingPollingCounter> <xref:System.Threading.Monitor.LockContentionCount?displayProperty=nameWithType> Toplam kilit çekişmesi sayısı artışını raporlamak için API 'yi kullanır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-171">The <xref:System.Diagnostics.Tracing.IncrementingPollingCounter> uses the <xref:System.Threading.Monitor.LockContentionCount?displayProperty=nameWithType> API to report the increment of the total lock contention count.</span></span> <span data-ttu-id="fe06b-172"><xref:System.Diagnostics.Tracing.IncrementingPollingCounter.DisplayRateTimeScale>Özelliği isteğe bağlıdır, ancak kullanıldığında sayacın en iyi gösterileceği zaman aralığı için bir ipucu sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-172">The <xref:System.Diagnostics.Tracing.IncrementingPollingCounter.DisplayRateTimeScale> property is optional, but when used it can provide a hint for what time interval the counter is best displayed at.</span></span> <span data-ttu-id="fe06b-173">Örneğin, kilit çakışması sayısı en iyi _sayı_olarak, <xref:System.Diagnostics.Tracing.IncrementingPollingCounter.DisplayRateTimeScale> bir saniye olarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-173">For example, the lock contention count is best displayed as _count per second_, so its <xref:System.Diagnostics.Tracing.IncrementingPollingCounter.DisplayRateTimeScale> is set to one second.</span></span> <span data-ttu-id="fe06b-174">Görüntüleme ücreti, farklı türlerde hız sayaçlarına göre ayarlanabilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-174">The display rate can be adjusted for different types of rate counters.</span></span>

> [!NOTE]
> <span data-ttu-id="fe06b-175">, <xref:System.Diagnostics.Tracing.IncrementingPollingCounter.DisplayRateTimeScale> [DotNet sayaçları](dotnet-counters.md)tarafından kullanılmaz ve olay dinleyicileri bunu kullanmak için gerekli değildir. _not_</span><span class="sxs-lookup"><span data-stu-id="fe06b-175">The <xref:System.Diagnostics.Tracing.IncrementingPollingCounter.DisplayRateTimeScale> is _not_ used by [dotnet-counters](dotnet-counters.md), and event listeners are not required to use it.</span></span>

<span data-ttu-id="fe06b-176">[.NET çalışma zamanı](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Private.CoreLib/src/System/Diagnostics/Tracing/RuntimeEventSource.cs) deposunda başvuru olarak kullanılacak daha fazla sayaç uygulaması vardır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-176">There are more counter implementations to use as a reference in the [.NET runtime](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Private.CoreLib/src/System/Diagnostics/Tracing/RuntimeEventSource.cs) repo.</span></span>

## <a name="concurrency"></a><span data-ttu-id="fe06b-177">Eşzamanlılık</span><span class="sxs-lookup"><span data-stu-id="fe06b-177">Concurrency</span></span>

> [!TIP]
> <span data-ttu-id="fe06b-178">EventCounters API 'SI iş parçacığı güvenliğini garanti etmez.</span><span class="sxs-lookup"><span data-stu-id="fe06b-178">The EventCounters API does not guarantee thread safety.</span></span> <span data-ttu-id="fe06b-179"><xref:System.Diagnostics.Tracing.PollingCounter>Veya örneklerine geçirilen temsilciler <xref:System.Diagnostics.Tracing.IncrementingPollingCounter> birden çok iş parçacığı tarafından çağrıldığında, temsilcilerin iş parçacığı güvenliğini güvence altına almak sizin sorumluluğunuzdadır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-179">When the delegates passed to <xref:System.Diagnostics.Tracing.PollingCounter> or <xref:System.Diagnostics.Tracing.IncrementingPollingCounter> instances are called by multiple threads, it's your responsibility to guarantee the delegates' thread-safety.</span></span>

<span data-ttu-id="fe06b-180">Örneğin, istekleri izlemek için aşağıdakileri göz önünde bulundurun <xref:System.Diagnostics.Tracing.EventSource> .</span><span class="sxs-lookup"><span data-stu-id="fe06b-180">For example, consider the following <xref:System.Diagnostics.Tracing.EventSource> to keep track of requests.</span></span>

:::code language="csharp" source="snippets/EventCounters/RequestEventSource.cs":::

<span data-ttu-id="fe06b-181">`AddRequest()`Yöntemi bir istek işleyicisinden çağrılabilir ve `RequestRateCounter` sayaç tüketicisi tarafından belirtilen aralıktaki değeri yoklar.</span><span class="sxs-lookup"><span data-stu-id="fe06b-181">The `AddRequest()` method can be called from a request handler, and the `RequestRateCounter` polls the value at the interval specified by the consumer of the counter.</span></span> <span data-ttu-id="fe06b-182">Ancak, `AddRequest()` yöntemi aynı anda birden çok iş parçacığı tarafından çağrılabilir ve üzerinde bir yarış durumu yerleştirilerek `_requestCount` .</span><span class="sxs-lookup"><span data-stu-id="fe06b-182">However, the `AddRequest()` method can be called by multiple threads at once, putting a race condition on `_requestCount`.</span></span> <span data-ttu-id="fe06b-183">İş parçacığı açısından güvenli bir alternatif yöntem `_requestCount` kullanmaktır <xref:System.Threading.Interlocked.Increment%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="fe06b-183">A thread-safe alternative way to increment the `_requestCount` is to use <xref:System.Threading.Interlocked.Increment%2A?displayProperty=nameWithType>.</span></span>

```csharp
public void AddRequest() => Interlocked.Increment(ref _requestCount);
```

## <a name="consume-eventcounters"></a><span data-ttu-id="fe06b-184">EventCounters kullanma</span><span class="sxs-lookup"><span data-stu-id="fe06b-184">Consume EventCounters</span></span>

<span data-ttu-id="fe06b-185">EventCounters, işlem içi veya proc dışı kullanmanın iki birincil yolu vardır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-185">There are two primary ways of consuming EventCounters, either in-proc, or out-of-proc.</span></span> <span data-ttu-id="fe06b-186">EventCounters 'in tüketimi, çeşitli teknolojilerin üç katmanında ayırt edilebilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-186">The consumption of EventCounters can be distinguished into three layers of various consuming technologies.</span></span>

- <span data-ttu-id="fe06b-187">Etkinlikleri ETW veya EventPipe aracılığıyla ham akışta taşıma:</span><span class="sxs-lookup"><span data-stu-id="fe06b-187">Transporting events in a raw stream via ETW or EventPipe:</span></span>
  - <span data-ttu-id="fe06b-188">ETW API 'Leri, Windows işletim sistemi ile birlikte gelir ve EventPipe bir [.NET API 'si](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/diagnostics-client-library.md#1-attaching-to-a-process-and-dumping-out-all-the-runtime-gc-events-in-real-time-to-the-console)veya Diagnostic [IPC Protokolü](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/ipc-protocol.md)olarak erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-188">ETW APIs come with the Windows OS, and EventPipe is accessible as a [.NET API](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/diagnostics-client-library.md#1-attaching-to-a-process-and-dumping-out-all-the-runtime-gc-events-in-real-time-to-the-console), or the diagnostic [IPC protocol](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/ipc-protocol.md).</span></span>
- <span data-ttu-id="fe06b-189">İkili olay akışını olaylara çözme:</span><span class="sxs-lookup"><span data-stu-id="fe06b-189">Decoding the binary event stream into events:</span></span>
  - <span data-ttu-id="fe06b-190">[TraceEvent kitaplığı](https://www.nuget.org/packages/Microsoft.Diagnostics.Tracing.TraceEvent) hem ETW hem de eventpipe akış biçimlerini işler.</span><span class="sxs-lookup"><span data-stu-id="fe06b-190">The [TraceEvent library](https://www.nuget.org/packages/Microsoft.Diagnostics.Tracing.TraceEvent) handles both ETW and EventPipe stream formats.</span></span>
- <span data-ttu-id="fe06b-191">Komut satırı ve GUI araçları:</span><span class="sxs-lookup"><span data-stu-id="fe06b-191">Command-line and GUI tools:</span></span>
  - <span data-ttu-id="fe06b-192">PerfView (ETW veya EventPipe), DotNet-sayaçlar (yalnızca EventPipe) ve DotNet-Monitor gibi araçlar (yalnızca EventPipe).</span><span class="sxs-lookup"><span data-stu-id="fe06b-192">Tools like PerfView (ETW or EventPipe), dotnet-counters (EventPipe only), and dotnet-monitor (EventPipe only).</span></span>

### <a name="consume-out-of-proc"></a><span data-ttu-id="fe06b-193">İşlem dışı tüketme</span><span class="sxs-lookup"><span data-stu-id="fe06b-193">Consume out-of-proc</span></span>

<span data-ttu-id="fe06b-194">İşlem dışı olay sayaçlarını tüketen çok yaygın bir yaklaşım vardır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-194">Consuming EventCounters out-of-proc is a very common approach.</span></span> <span data-ttu-id="fe06b-195">Bir EventPipe aracılığıyla bunları platformlar arası bir şekilde kullanmak için [DotNet-Counters](dotnet-counters.md) kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="fe06b-195">You can use [dotnet-counters](dotnet-counters.md) to consume them in a cross-platform manner via an EventPipe.</span></span> <span data-ttu-id="fe06b-196">`dotnet-counters`Araç, sayaç değerlerini izlemek için kullanılabilen bir platformlar arası DotNet CLI genel aracıdır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-196">The `dotnet-counters` tool is a cross-platform dotnet CLI global tool that can be used to monitor the counter values.</span></span> <span data-ttu-id="fe06b-197">`dotnet-counters`Sayaçlarınızı izlemek için ' nin nasıl kullanılacağını öğrenmek için, bkz. [DotNet-Counters](dotnet-counters.md)veya [eventcounters aracılığıyla ölçüm performansı](event-counter-perf.md) aracılığıyla çalışma.</span><span class="sxs-lookup"><span data-stu-id="fe06b-197">To find out how to use `dotnet-counters` to monitor your counters, see [dotnet-counters](dotnet-counters.md), or work through the [Measure performance using EventCounters](event-counter-perf.md) tutorial.</span></span>

#### <a name="dotnet-trace"></a><span data-ttu-id="fe06b-198">dotnet-trace</span><span class="sxs-lookup"><span data-stu-id="fe06b-198">dotnet-trace</span></span>

<span data-ttu-id="fe06b-199">`dotnet-trace`Araç, bir EventPipe aracılığıyla sayaç verilerini tüketmek için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-199">The `dotnet-trace` tool can be used to consume the counter data through an EventPipe.</span></span> <span data-ttu-id="fe06b-200">Aşağıda, `dotnet-trace` sayaç verilerini toplamak için kullanılan bir örnek verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-200">Here is an example using `dotnet-trace` to collect counter data.</span></span>

```console
dotnet-trace collect --process-id <pid> Sample.EventCounter.Minimal:0:0:EventCounterIntervalSec=1
```

<span data-ttu-id="fe06b-201">Zaman içinde sayaç değerlerini toplama hakkında daha fazla bilgi için bkz. [DotNet-Trace](dotnet-trace.md#use-dotnet-trace-to-collect-counter-values-over-time) belgeleri.</span><span class="sxs-lookup"><span data-stu-id="fe06b-201">For more information on how to collect counter values over time, see the [dotnet-trace](dotnet-trace.md#use-dotnet-trace-to-collect-counter-values-over-time) documentation.</span></span>

#### <a name="azure-application-insights"></a><span data-ttu-id="fe06b-202">Azure Application Insights</span><span class="sxs-lookup"><span data-stu-id="fe06b-202">Azure Application Insights</span></span>

<span data-ttu-id="fe06b-203">EventCounters Azure Izleyici tarafından, özellikle Azure Application Insights tüketilebilir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-203">EventCounters can be consumed by Azure Monitor, specifically Azure Application Insights.</span></span> <span data-ttu-id="fe06b-204">Sayaçlar eklenebilir ve kaldırılabilir ve özel sayaçlar veya iyi bilinen sayaçlar belirtebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="fe06b-204">Counters can be added and removed, and you're free to specify custom counters, or well-known counters.</span></span> <span data-ttu-id="fe06b-205">Daha fazla bilgi için bkz. [sayaçların toplanmasını sağlamak](/azure/azure-monitor/app/eventcounters#customizing-counters-to-be-collected).</span><span class="sxs-lookup"><span data-stu-id="fe06b-205">For more information, see [Customizing counters to be collected](/azure/azure-monitor/app/eventcounters#customizing-counters-to-be-collected).</span></span>

#### <a name="dotnet-monitor"></a><span data-ttu-id="fe06b-206">DotNet-izleyici</span><span class="sxs-lookup"><span data-stu-id="fe06b-206">dotnet-monitor</span></span>

<span data-ttu-id="fe06b-207">, `dotnet-monitor` Bir .net işlemindeki tanılama bilgilerine erişimi daha kolay hale getiren deneysel bir araçtır.</span><span class="sxs-lookup"><span data-stu-id="fe06b-207">The `dotnet-monitor` is an experimental tool that makes it easier to get access to diagnostics information in a .NET process.</span></span> <span data-ttu-id="fe06b-208">Daha fazla bilgi için bkz. [deneysel bir araç olan DotNet-Monitor](https://devblogs.microsoft.com/dotnet/introducing-dotnet-monitor).</span><span class="sxs-lookup"><span data-stu-id="fe06b-208">For more information, see [Introducing dotnet-monitor, an experimental tool](https://devblogs.microsoft.com/dotnet/introducing-dotnet-monitor).</span></span>

### <a name="consume-in-proc"></a><span data-ttu-id="fe06b-209">İşlem içi tüketme</span><span class="sxs-lookup"><span data-stu-id="fe06b-209">Consume in-proc</span></span>

<span data-ttu-id="fe06b-210">Sayaç değerlerini API aracılığıyla kullanabilirsiniz <xref:System.Diagnostics.Tracing.EventListener> .</span><span class="sxs-lookup"><span data-stu-id="fe06b-210">You can consume the counter values via the <xref:System.Diagnostics.Tracing.EventListener> API.</span></span> <span data-ttu-id="fe06b-211"><xref:System.Diagnostics.Tracing.EventListener>, Uygulamanızdaki tüm örnekleri tarafından yazılmış olayları kullanmanın işlem içi bir yoludur <xref:System.Diagnostics.Tracing.EventSource> .</span><span class="sxs-lookup"><span data-stu-id="fe06b-211">An <xref:System.Diagnostics.Tracing.EventListener> is an in-proc way of consuming any events written by all instances of an <xref:System.Diagnostics.Tracing.EventSource> in your application.</span></span> <span data-ttu-id="fe06b-212">API 'yi kullanma hakkında daha fazla bilgi için `EventListener` bkz <xref:System.Diagnostics.Tracing.EventListener> ..</span><span class="sxs-lookup"><span data-stu-id="fe06b-212">For more information on how to use the `EventListener` API, see <xref:System.Diagnostics.Tracing.EventListener>.</span></span>

<span data-ttu-id="fe06b-213">İlk olarak, <xref:System.Diagnostics.Tracing.EventSource> sayaç değerini üreten değerin etkinleştirilmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="fe06b-213">First, the <xref:System.Diagnostics.Tracing.EventSource> that produces the counter value needs to be enabled.</span></span> <span data-ttu-id="fe06b-214"><xref:System.Diagnostics.Tracing.EventListener.OnEventSourceCreated%2A?displayProperty=nameWithType>Oluşturulduğunda bildirim almak için yöntemi geçersiz kılın <xref:System.Diagnostics.Tracing.EventSource> ve bu, <xref:System.Diagnostics.Tracing.EventSource> eventsayaçlarınız ile doğruysa, üzerinde arama yapabilirsiniz <xref:System.Diagnostics.Tracing.EventListener.EnableEvents%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="fe06b-214">Override the <xref:System.Diagnostics.Tracing.EventListener.OnEventSourceCreated%2A?displayProperty=nameWithType> method to get a notification when an <xref:System.Diagnostics.Tracing.EventSource> is created, and if this is the correct <xref:System.Diagnostics.Tracing.EventSource> with your EventCounters, then you can call <xref:System.Diagnostics.Tracing.EventListener.EnableEvents%2A?displayProperty=nameWithType> on it.</span></span> <span data-ttu-id="fe06b-215">Örnek bir geçersiz kılma aşağıda verilmiştir:</span><span class="sxs-lookup"><span data-stu-id="fe06b-215">Here is an example override:</span></span>

:::code language="csharp" source="snippets/EventCounters/SimpleEventListener.cs" range="16-27":::

#### <a name="sample-code"></a><span data-ttu-id="fe06b-216">Örnek kod</span><span class="sxs-lookup"><span data-stu-id="fe06b-216">Sample code</span></span>

<span data-ttu-id="fe06b-217">Burada <xref:System.Diagnostics.Tracing.EventListener> .NET çalışma zamanının tüm sayaç adlarını ve değerlerini, <xref:System.Diagnostics.Tracing.EventSource> iç sayaçlarını () yayımlamak için bir aralıkta yazdıran örnek bir sınıf verilmiştir `System.Runtime` .</span><span class="sxs-lookup"><span data-stu-id="fe06b-217">Here is a sample <xref:System.Diagnostics.Tracing.EventListener> class that prints out all the counter names and values from the .NET runtime's <xref:System.Diagnostics.Tracing.EventSource>, for publishing its internal counters (`System.Runtime`) at some interval.</span></span>

:::code language="csharp" source="snippets/EventCounters/SimpleEventListener.cs":::

<span data-ttu-id="fe06b-218">Yukarıda gösterildiği gibi, çağrılırken bağımsız değişkenin bağımsız değişkeninde ayarlandığından emin _olmanız gerekir_ `"EventCounterIntervalSec"` `filterPayload` <xref:System.Diagnostics.Tracing.EventListener.EnableEvents%2A> .</span><span class="sxs-lookup"><span data-stu-id="fe06b-218">As shown above, you _must_ make sure the `"EventCounterIntervalSec"` argument is set in the `filterPayload` argument when calling <xref:System.Diagnostics.Tracing.EventListener.EnableEvents%2A>.</span></span> <span data-ttu-id="fe06b-219">Aksi takdirde sayaçlar, hangi zaman boşaltıyoruz olduğunu bilmediğinden, değerleri temizleyemiyor.</span><span class="sxs-lookup"><span data-stu-id="fe06b-219">Otherwise the counters will not be able to flush out values since it doesn't know at which interval it should be getting flushed out.</span></span>

## <a name="see-also"></a><span data-ttu-id="fe06b-220">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="fe06b-220">See also</span></span>

- [<span data-ttu-id="fe06b-221">dotnet-counters</span><span class="sxs-lookup"><span data-stu-id="fe06b-221">dotnet-counters</span></span>](dotnet-counters.md)
- [<span data-ttu-id="fe06b-222">dotnet-trace</span><span class="sxs-lookup"><span data-stu-id="fe06b-222">dotnet-trace</span></span>](dotnet-trace.md)
- <xref:System.Diagnostics.Tracing.EventCounter>
- <xref:System.Diagnostics.Tracing.EventListener>
- <xref:System.Diagnostics.Tracing.EventSource>
